<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Merry Christmas ‚ù§Ô∏è</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* --- 1. MAIN PAGE STYLES --- */
body {
  margin: 0;
  height: 100vh;
  background: radial-gradient(circle at top, #0b1d3a, #020111 70%);
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: 'Courier New', monospace;
  color: white;
  overflow: hidden;
}

/* Stars */
.star {
  position: absolute;
  width: 2px;
  height: 2px;
  background: white;
  border-radius: 50%;
  opacity: 0.8;
  animation: twinkle 2s infinite alternate;
}
@keyframes twinkle {
  from { opacity: 0.3; }
  to { opacity: 1; }
}

/* Snow */
.snow {
  position: absolute;
  top: -10px;
  animation: fall linear infinite;
  pointer-events: none;
}
@keyframes fall {
  to { transform: translateY(110vh); }
}

/* Hearts */
.heart {
  position: absolute;
  bottom: -20px;
  animation: rise 6s linear infinite;
}
@keyframes rise {
  to { transform: translateY(-120vh); opacity: 0; }
}

.container {
  text-align: center;
  width: 90%;
  max-width: 520px;
  z-index: 10;
}

.hidden { display: none !important; }

/* Titles */
.title {
  font-size: 32px;
  text-shadow: 0 0 15px rgba(255,255,255,0.6);
  margin-bottom: 15px;
}
.subtitle {
  font-size: 14px;
  opacity: 0.85;
  margin-bottom: 20px;
}

/* Tree */
.tree {
  font-size: 120px;
  cursor: pointer;
  position: relative;
  transition: transform 0.2s;
}
.tree:active { transform: scale(0.95); }

.light {
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  animation: glow 1.5s infinite alternate;
}
@keyframes glow {
  from { box-shadow: 0 0 5px currentColor; }
  to { box-shadow: 0 0 15px currentColor; }
}

.counter {
  font-size: 13px;
  margin-bottom: 20px;
}

/* Gift */
.gift {
  font-size: 90px;
  cursor: pointer;
  animation: float 3s ease-in-out infinite;
  transition: transform 0.3s;
}
.gift:hover { transform: scale(1.1); }
@keyframes float {
  50% { transform: translateY(-20px); }
}

/* --- MESSAGE BOX STYLES --- */
.box {
  background: rgba(255, 255, 255, 0.1);
  padding: 30px 25px;
  border-radius: 15px;
  white-space: pre-line;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  min-height: 100px;
  font-size: 19px; 
  line-height: 1.7; 
}

/* Cursor Blink Animation */
.typing {
  border-right: 3px solid white;
  animation: blink 0.8s infinite;
}
@keyframes blink {
  50% { border-color: transparent; }
}

/* Buttons */
.btn {
  margin-top: 25px;
  padding: 12px 30px;
  border-radius: 30px;
  font-weight: bold;
  cursor: pointer;
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.6);
  color: white;
  backdrop-filter: blur(4px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
  font-family: inherit;
  font-size: 17px;
}

.btn:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(255, 255, 255, 0.2);
}

.btn-row {
  position: relative;
  height: 100px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
}

/* Z-INDEX LAYERING FIX */
#yesBtn {
  z-index: 2; 
  background: rgba(255, 20, 147, 0.3);
  border-color: rgba(255, 105, 180, 0.8);
  position: relative;
}

#noBtn {
  z-index: 10;
  background: rgba(255, 255, 255, 0.1);
  color: #ddd;
  transition: transform 0.1s ease-out;
  position: relative; 
}

/* Confetti */
#confetti {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 5;
}

/* --- 2. CUSTOM ALERT MODAL STYLES --- */
.custom-alert-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding-top: 80px;
  z-index: 10000;
  visibility: hidden;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.custom-alert-overlay.active {
  visibility: visible;
  opacity: 1;
}

.custom-alert-box {
  background-color: #1b1613;
  width: 420px;
  max-width: 90%;
  padding: 24px;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
  border: 1px solid #2d2620;
  transform: scale(0.95);
  transition: transform 0.2s ease;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  text-align: left;
}

.custom-alert-overlay.active .custom-alert-box {
  transform: scale(1);
}

.alert-title {
  font-size: 15px;
  font-weight: 700;
  color: #ffdcb0;
  margin-bottom: 8px;
}

.alert-message {
  font-size: 14px;
  color: #ffffff;
  margin-bottom: 24px;
  line-height: 1.4;
}

.alert-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

.modal-btn {
  padding: 10px 24px;
  border-radius: 50px;
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
  border: none;
  font-family: inherit;
}

.btn-ok {
  background-color: #ffcc80;
  color: #2d1b15;
  border: 2px solid #2d1b15;
  box-shadow: 0 0 0 2px #ffcc80; 
  margin-right: 2px;
}
.btn-ok:active { background-color: #ffb74d; }

.btn-cancel {
  background-color: #4e342e;
  color: #ffcc80;
}
.btn-cancel:hover { background-color: #5d4037; }

</style>
</head>

<body>

<audio id="music" src="music.mp3" loop></audio>
<audio id="whisper" src="whisper.mp3"></audio>

<div class="container">

  <div id="titleScreen">
    <div class="title">üéÑ Merry Christmas üéÑ</div>
    <div class="subtitle">Light the tree, then open your gift ‚ú®</div>
    <div class="tree" id="tree">üéÑ</div>
    <div class="counter" id="count">Lights added: 0</div>
    <div class="gift" id="gift">üéÅ</div>
  </div>

  <div id="page1" class="hidden">
    <div class="title">üíå A Christmas Note</div>
    <div id="msg1" class="box typing"></div>
    <button id="skip1" class="btn" style="margin-top: 10px;">Skip ‚è≠Ô∏è</button>
    <button id="next1" class="btn hidden">Next ‚ù§Ô∏è</button>
  </div>

  <div id="pageLDR" class="hidden">
    <div class="title">üåè Miles Apart</div>
    <div id="msgLDR" class="box typing"></div>
    <button id="skipLDR" class="btn" style="margin-top: 10px;">Skip ‚è≠Ô∏è</button>
    <button id="nextLDR" class="btn hidden">Next üíñ</button>
  </div>

  <div id="pageFinal" class="hidden">
    <div class="title">üíç One Last Thing...</div>
    <div id="msgFinal" class="box typing"></div>
    
    <button id="skipFinal" class="btn" style="margin-top: 10px;">Skip ‚è≠Ô∏è</button>

    <div id="finalButtons" class="btn-row hidden">
      <button id="yesBtn" class="btn">Yes üíñ</button>
      <button id="noBtn" class="btn">No üôÖ‚Äç‚ôÄÔ∏è</button>
    </div>
    <canvas id="confetti"></canvas>
  </div>

</div>

<div id="customAlert" class="custom-alert-overlay">
  <div class="custom-alert-box">
    <div class="alert-title">This page says</div>
    <div class="alert-message" id="modalText">REALLY? YOU'RE SKIPPING THE MESSAGE? FINE! üò§</div>
    <div class="alert-buttons">
      <button class="modal-btn btn-ok" id="modalOk">OK</button>
      <button class="modal-btn btn-cancel" id="modalCancel">Cancel</button>
    </div>
  </div>
</div>

<script>
/* --- 1. SETUP: STARS, SNOW, HEARTS --- */
for (let i = 0; i < 80; i++) {
  const s = document.createElement("div"); s.className = "star"; s.style.left = Math.random()*100+"vw"; s.style.top = Math.random()*100+"vh"; document.body.appendChild(s);
}
setInterval(() => {
  const s = document.createElement("div"); s.className = "snow"; s.innerHTML = "‚ùÑ"; s.style.left = Math.random()*100+"vw"; s.style.fontSize = Math.random()*10+10+"px"; s.style.animationDuration = Math.random()*3+2+"s"; document.body.appendChild(s); setTimeout(()=>s.remove(),5000);
},120);
setInterval(() => {
  const h = document.createElement("div"); h.className = "heart"; h.innerHTML = "‚ù§Ô∏è"; h.style.left = Math.random()*100+"vw"; document.body.appendChild(h); setTimeout(()=>h.remove(),6000);
},900);

/* Tree lights */
let lights = 0; const tree = document.getElementById("tree"); const counter = document.getElementById("count");
tree.onclick = (e) => {
  const rect = tree.getBoundingClientRect(); const l = document.createElement("div"); l.className = "light"; l.style.left = (e.clientX - rect.left - 5) + "px"; l.style.top = (e.clientY - rect.top - 5) + "px"; l.style.background = ["red","yellow","cyan","pink"][Math.floor(Math.random()*4)]; tree.appendChild(l); counter.innerText = `Lights added: ${++lights}`;
};

/* --- 2. CONTENT DATA --- */

const content = [
  {
    // Page 1 Data
    text: `Merry Christmas, my love ‚ù§Ô∏è

If I could send my heart directly to you tonight, it would find its way across the distance in seconds.

Thank you for being my warmth, my calm, and my safe space, even from afar.‚ú®`,
    elementId: 'msg1',
    nextBtnId: 'next1',
    skipBtnId: 'skip1',
    prompt: "REALLY? YOU'RE SKIPPING THE MESSAGE? FINE! üò§"
  },
  {
    // Page 2 (LDR) Data
    text: `Even though miles separate us right now, you are always in my thoughts.

Every morning text, every late-night call, and just hearing your voice makes the distance feel a little smaller.

I dream of the day I can finally hold you close instead of just holding my phone. But until then, you are worth every second of waiting. ‚ù§Ô∏è`,
    elementId: 'msgLDR',
    nextBtnId: 'nextLDR',
    skipBtnId: 'skipLDR',
    prompt: "Wow. You can't wait 10 seconds? I poured my heart out! üòí"
  },
  {
    // Page 3 (Final) Data
    text: `Will you be my forever?`,
    elementId: 'msgFinal',
    nextBtnId: 'finalButtons', // This reveals the Yes/No row
    skipBtnId: 'skipFinal',
    prompt: "SERIOUSLY? It's the big question! Don't rush this! üò´"
  }
];

/* --- 3. TYPING & FLOW ENGINE --- */

let step = 0; // 0 = Page 1, 1 = Page LDR, 2 = Final
let charIndex = 0;
let isTyping = false;
let typingTimeout;

const whisper = document.getElementById("whisper");
const music = document.getElementById("music");
const customAlert = document.getElementById("customAlert");
const modalText = document.getElementById("modalText");
const modalOk = document.getElementById("modalOk");
const modalCancel = document.getElementById("modalCancel");

function startStep(index) {
  step = index;
  charIndex = 0;
  isTyping = true;
  
  // Hide current Next button (if any)
  const currentData = content[step];
  document.getElementById(currentData.nextBtnId).classList.add("hidden");
  document.getElementById(currentData.skipBtnId).classList.remove("hidden");
  
  // Clear box
  const box = document.getElementById(currentData.elementId);
  box.innerHTML = "";
  box.classList.add("typing");
  
  typeLoop();
}

function typeLoop() {
  const data = content[step];
  const box = document.getElementById(data.elementId);
  
  if (charIndex < data.text.length) {
    whisper.currentTime = 0; 
    whisper.play();
    box.innerHTML += data.text.charAt(charIndex++);
    typingTimeout = setTimeout(typeLoop, 45); // Typing speed
  } else {
    finishTyping();
  }
}

function finishTyping() {
  clearTimeout(typingTimeout);
  isTyping = false;
  whisper.pause();
  
  const data = content[step];
  const box = document.getElementById(data.elementId);
  
  // Fill full text instantly
  box.innerHTML = data.text;
  box.classList.remove("typing");
  
  // Hide Skip, Show Next
  document.getElementById(data.skipBtnId).classList.add("hidden");
  document.getElementById(data.nextBtnId).classList.remove("hidden");
}

/* --- 4. SKIP BUTTON LOGIC --- */
// We attach listeners dynamically or just logic based on 'step'
function handleSkip() {
  if (isTyping) {
    // Show modal with the specific prompt for this step
    modalText.innerText = content[step].prompt;
    customAlert.classList.add("active");
  }
}

// Attach skip click handlers
document.getElementById('skip1').onclick = handleSkip;
document.getElementById('skipLDR').onclick = handleSkip;
document.getElementById('skipFinal').onclick = handleSkip;

// Modal Actions
modalOk.onclick = () => {
  customAlert.classList.remove("active");
  finishTyping(); // Complete the current step instantly
};

modalCancel.onclick = () => {
  customAlert.classList.remove("active");
  // Resume typing (nothing changes, timeout is still running)
};

/* --- 5. PAGE NAVIGATION EVENTS --- */

// Start
document.getElementById("gift").onclick = () => {
  music.play();
  document.getElementById("titleScreen").classList.add("hidden");
  document.getElementById("page1").classList.remove("hidden");
  startStep(0);
};

// Page 1 -> Page LDR
document.getElementById("next1").onclick = () => {
  document.getElementById("page1").classList.add("hidden");
  document.getElementById("pageLDR").classList.remove("hidden");
  startStep(1);
};

// Page LDR -> Page Final
document.getElementById("nextLDR").onclick = () => {
  document.getElementById("pageLDR").classList.add("hidden");
  document.getElementById("pageFinal").classList.remove("hidden");
  startStep(2);
};

/* --- 6. YES/NO BUTTON LOGIC --- */
const yesBtn = document.getElementById("yesBtn");
const noBtn = document.getElementById("noBtn");
const msgFinal = document.getElementById("msgFinal"); // We reuse the typing box for updates
let scale = 1; 
let noClicked = false; 
let noAttempts = 0;

const noMessages = [
  "Are you sure about that? ü§®", 
  "Really? Think again! üò§", 
  "Come on, don't be mean! üò†", 
  "Stop playing hard to get! üò°", 
  "You're breaking my heart! üíî", 
  "Just say YES already! üò≠"
];

function moveNo() {
  if (!noClicked) {
    noClicked = true;
    // Update the final message box briefly to complain
    msgFinal.innerText = noMessages[Math.min(noAttempts, noMessages.length - 1)];
    msgFinal.style.color = "#ff6b6b"; 
    noAttempts++;
    
    // Wide Jump
    const rangeX = window.innerWidth * 0.35; 
    const rangeY = window.innerHeight * 0.35;
    const randomX = Math.random() * rangeX * 2 - rangeX; 
    const randomY = Math.random() * rangeY * 2 - rangeY;
    
    noBtn.style.position = 'absolute';
    noBtn.style.transform = `translate(${randomX}px, ${randomY}px)`;
    
    // Grow Yes Button
    scale += 0.2; 
    yesBtn.style.transform = `scale(${scale})`;
    
    setTimeout(() => { noClicked = false; }, 200);
  }
}

noBtn.addEventListener("mouseover", moveNo); 
noBtn.addEventListener("touchstart", (e) => { e.preventDefault(); moveNo(); }); 
noBtn.addEventListener("click", (e) => { e.preventDefault(); moveNo(); });

yesBtn.addEventListener("mouseover", () => { 
  scale += 0.05; 
  yesBtn.style.transform = `scale(${scale})`; 
});

yesBtn.onclick = () => {
  // Final Success State
  document.getElementById("pageFinal").innerHTML = `
    <div class="title">üíñ Forever & Always</div>
    <div class="box" style="border-color:#ff4d6d; background: rgba(255,77,109,0.2)">
      You already are my forever. No distance can change that. üíç‚ú®<br><br>I love you.
    </div>
  `;
  launchConfetti();
};

/* Confetti */
function launchConfetti() {
  const canvas = document.getElementById("confetti"); 
  const ctx = canvas.getContext("2d"); 
  canvas.width = innerWidth; 
  canvas.height = innerHeight;
  
  const pieces = []; 
  const colors = ["#ff4d6d","#ffd166","#06d6a0","#4cc9f0","#f72585"];
  
  for (let i = 0; i < 150; i++) { 
    pieces.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height - canvas.height, size: Math.random()*6+4, speed: Math.random()*3+2, color: colors[Math.floor(Math.random()*colors.length)] }); 
  }
  
  function draw() { 
    ctx.clearRect(0,0,canvas.width,canvas.height); 
    pieces.forEach(p => { 
      p.y += p.speed; 
      ctx.fillStyle = p.color; 
      ctx.fillRect(p.x,p.y,p.size,p.size); 
    }); 
    requestAnimationFrame(draw); 
  }
  draw();
}
</script>
</body>
</html>
